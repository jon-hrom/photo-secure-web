# üì± –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

–¢–µ–ø–µ—Ä—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ã –º–æ–≥—É—Ç **–∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –ø—Ä—è–º–æ —Å –∫–∞–º–µ—Ä—ã –Ω–∞ —Å–∞–π—Ç** –±–µ–∑ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–∞–º–µ—Ä—É/–∫–∞—Ä—Ç—É –∫ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã (RAW, JPEG, –ª—é–±—ã–µ)
- ‚úÖ –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é –≤ –æ–±–ª–∞–∫–æ** (Yandex Object Storage)
- ‚úÖ –ë–µ–∑ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä ‚Äî –≤—Å—ë –∏–¥—ë—Ç —á–µ—Ä–µ–∑ pre-signed URL

---

## üöÄ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

### 1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –∫ —Ç–µ–ª–µ—Ñ–æ–Ω—É

#### Android:
- **USB OTG**: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–∞–º–µ—Ä—É –∏–ª–∏ SD-—Ä–∏–¥–µ—Ä —á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫
- **Wi-Fi**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (Canon Camera Connect, Nikon SnapBridge –∏ —Ç.–¥.)

#### iOS:
- **Lightning/Type-C –∞–¥–∞–ø—Ç–µ—Ä**: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ SD-–∫–∞—Ä—Ç—É —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä
- **Wi-Fi**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã

### 2Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∞–π—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ **foto-mix.ru** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"** (–∑–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞)
4. –ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞–ø—Ä—è–º—É—é: `/mobile-upload`

### 3Ô∏è‚É£ –í—ã–±–æ—Ä —Ñ–∞–π–ª–æ–≤

- –ù–∞–∂–º–∏—Ç–µ **"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã"**
- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ —Å –∫–∞—Ä—Ç—ã/–∫–∞–º–µ—Ä—ã (–º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: RAW, CR2, NEF, ARW, DNG, JPEG, PNG

### 4Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞

- –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å"**
- –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **–ø–æ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–Ω–æ —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞

---

## üí° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–¢–µ–ª–µ—Ñ–æ–Ω ‚Üí –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ ‚Üí Backend (pre-signed URL) ‚Üí S3 (–ø—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞) ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–º–µ—Ç–∞-–∏–Ω—Ñ–æ)
```

### Backend API

**–≠–Ω–¥–ø–æ–∏–Ω—Ç**: `https://functions.poehali.dev/3372b3ed-5509-41e0-a542-b3774be6b702`

#### –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
```http
GET /?action=get-url&filename=photo.jpg&contentType=image/jpeg
Headers:
  X-User-Id: {userId}

Response:
{
  "url": "https://storage.yandexcloud.net/...",
  "key": "uploads/123/1234567890_abc123.jpg",
  "expires_in": 900
}
```

#### –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
```http
POST /
Headers:
  X-User-Id: {userId}
  Content-Type: application/json

Body:
{
  "action": "confirm",
  "s3_key": "uploads/123/1234567890_abc123.jpg",
  "orig_filename": "photo.jpg",
  "size_bytes": 1024000,
  "content_type": "image/jpeg"
}

Response:
{
  "success": true,
  "upload_id": 42,
  "uploaded_at": "2025-12-31T10:30:00Z"
}
```

#### –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```http
GET /?action=list
Headers:
  X-User-Id: {userId}

Response:
[
  {
    "id": 42,
    "s3_key": "uploads/123/...",
    "filename": "photo.jpg",
    "size_bytes": 1024000,
    "uploaded_at": "2025-12-31T10:30:00Z",
    "status": "uploaded",
    "content_type": "image/jpeg",
    "view_url": "https://storage.yandexcloud.net/..."
  }
]
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞**: `t_p28211681_photo_secure_web.uploads`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | BIGSERIAL | ID –∑–∞–ø–∏—Å–∏ |
| user_id | BIGINT | ID —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ |
| shoot_id | BIGINT | ID —Å—ä—ë–º–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| s3_key | TEXT | –ö–ª—é—á —Ñ–∞–π–ª–∞ –≤ S3 |
| uploaded_at | TIMESTAMPTZ | –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ |
| status | TEXT | uploaded / processing / ready / failed |
| orig_filename | TEXT | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ |
| size_bytes | BIGINT | –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö |
| content_type | TEXT | MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞ |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Pre-signed URL –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω **15 –º–∏–Ω—É—Ç**
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (X-User-Id)
- ‚úÖ –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω–æ –≤ S3
- ‚úÖ –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ URL (1 —á–∞—Å)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
SELECT 
  id, 
  orig_filename, 
  size_bytes, 
  status, 
  uploaded_at 
FROM t_p28211681_photo_secure_web.uploads 
WHERE user_id = 1 
ORDER BY uploaded_at DESC 
LIMIT 10;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫
```sql
SELECT 
  status, 
  COUNT(*) as count, 
  SUM(size_bytes) / 1024 / 1024 as total_mb 
FROM t_p28211681_photo_secure_web.uploads 
GROUP BY status;
```

---

## üõ† –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –ø–æ —Å—ä—ë–º–∫–∞–º

–í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `shoot_id`:

```typescript
// Frontend
const { url, key } = await fetch(
  `${API_URL}?action=get-url&filename=${file.name}&shoot_id=42`
);

// Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø—É—Ç—å:
// shoots/{user_id}/{shoot_id}/originals/{timestamp}_{random}.{ext}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–≤—å—é (–º–∏–Ω–∏–∞—Ç—é—Ä—ã)
2. –ò–∑–≤–ª–µ—á—å EXIF –¥–∞–Ω–Ω—ã–µ
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (—Ä–µ—Ç—É—à—å, —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è)

```python
# –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
def process_uploaded_file(upload_id: int):
    # –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª –∏–∑ S3
    # –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–≤—å—é
    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ 'processing'
    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ 'ready'
    pass
```

---

## üì± PWA (Progressive Web App)

–°–∞–π—Ç –º–æ–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

1. –î–æ–±–∞–≤–∏—Ç—å `manifest.json`:
```json
{
  "name": "foto-mix",
  "short_name": "foto-mix",
  "start_url": "/mobile-upload",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#9333ea",
  "icons": [...]
}
```

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
3. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üêõ Troubleshooting

### –§–∞–π–ª—ã –Ω–µ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –Ω–∞ iOS
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä (Lightning/Type-C)
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ –≤ –≥–∞–ª–µ—Ä–µ—é

### –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ

### RAW —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- –î–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ `accept` –∞—Ç—Ä–∏–±—É—Ç:
```html
<input accept="image/*,video/*,.raw,.cr2,.nef,.arw,.dng" />
```

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω, –±–µ–∑ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫!

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞:**
- ‚úÖ Android 12+ (Chrome, Samsung Internet)
- ‚úÖ iOS 15+ (Safari)
- ‚úÖ RAW —Ñ–æ—Ä–º–∞—Ç—ã (CR2, NEF, ARW, DNG)
- ‚úÖ JPEG, PNG, HEIC
